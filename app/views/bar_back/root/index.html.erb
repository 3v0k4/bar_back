<%= form_with url: root_path, method: :get do |form| %>
  <%= form.label :query %>
  <br />
  <%= form.text_area :query, value: @query.string %>
  <br />
  <%= form.submit "run" %>
<% end %>

<% if @result.present? && @result.valid? %>
  <table>
    <tr>
      <% @result.columns.each do |column| %>
        <th><%= column %></th>
      <% end %>
    </tr>
    <% @result.rows.each do |row| %>
      <tr>
        <% row.each do |value| %>
          <td><%= value %></td>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>

<% if @result.present? && @result.invalid? %>
  <%= @result.error_message %>
<% end %>

<%= form_with model: @query, method: :post do |form| %>
  <%= form.label :name %>
  <%= form.text_field :name %>
  <%= form.hidden_field :string, value: @query.string %>
  <%= form.submit "save" %>
<% end %>

<ul>
  <% @queries.each do |query| %>
    <li><%= link_to query.name, query_path(id: query.id) %></li>
  <% end %>
</ul>
